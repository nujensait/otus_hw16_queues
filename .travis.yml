# build here: https://app.travis-ci.com/github/nujensait/otus_hw16_queues/builds/260119105
# Required to run your project under the correct environment.
language: php

# Versions of PHP you want your project run with.
php:
  - 8.1

# deployment settings
#deploy:
#  provider: pages
#  skip_cleanup: true
#  api_key: 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
#  keep_history: true
#  on:
#    branch: main

sudo: required
services:
  - docker

# enviroment variables
env:
  DEPLOY_VERSION: 1.0
  COMPOSE_VERSION: 1.4.1

# steps before
before_script:
  - cp .env.example .env
  - cd code
  - composer self-update
  - composer install --prefer-source --no-interaction --dev
  - cd ../
  - cp code/src/Application/Views/info.php code/src/Application/Views/tmp.php
  - mv code/src/Application/Views/deploy.php code/src/Application/Views/info.php
  - pwd

# deployment scripts
script:
  - docker-compose down
  - docker-compose build
  - docker-compose up -d
  - pwd

# after deploy
after_script:
  - cp code/src/Application/Views/tmp.php code/src/Application/Views/info.php
  - pwd

# Customize when the notification emails are sent.
notifications:
  email: true
